name: Tagged Release on Commit Message

on:
  push:
    paths:
      - 'vencord/Vertical-Spacious-Refresh.css'

jobs:
  release:
    runs-on: ubuntu-latest
    if: startsWith(github.event.head_commit.message, 'Release')

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Extract version from commit message
      id: get_version
      run: |
        COMMIT_MSG="${{ github.event.head_commit.message }}"
        VERSION=$(echo "$COMMIT_MSG" | grep -oP 'Release\s+\K[0-9]+\.[0-9]+\.[0-9]+')
        echo "VERSION=$VERSION"
        echo "version=$VERSION" >> $GITHUB_OUTPUT

    - name: Create GitHub release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: "v${{ steps.get_version.outputs.version }}"
        name: "Release ${{ steps.get_version.outputs.version }}"
        files: vencord/Vertical-Spacious-Refresh.css
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
